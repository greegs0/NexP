<% content_for :page_title, "Nouveau projet" %>

<div class="max-w-4xl mx-auto animate-fade-in-up">
  <div class="mb-4 sm:mb-8">
    <h1 class="text-2xl sm:text-3xl font-bold text-foreground">Créer un nouveau projet<span class="text-primary">.</span></h1>
    <p class="text-sm sm:text-base text-muted-foreground mt-1 sm:mt-2">Démarre un projet collaboratif et trouve des membres motivés</p>
  </div>

  <div class="card">
    <%= form_with(model: @project, local: true) do |f| %>
      <% if @project.errors.any? %>
        <div class="mb-4 sm:mb-6 p-3 sm:p-4 bg-destructive/10 border border-destructive rounded-lg">
          <h2 class="font-bold text-destructive text-sm sm:text-base mb-2">
            <%= pluralize(@project.errors.count, "erreur") %> empêche la création du projet :
          </h2>
          <ul class="list-disc list-inside text-xs sm:text-sm text-destructive">
            <% @project.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="space-y-4 sm:space-y-6">
        <div data-controller="form-validation" data-form-validation-min-length-value="3" data-form-validation-max-length-value="100" data-form-validation-required-value="true">
          <%= f.label :title, "Titre du projet *", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
          <%= f.text_field :title,
              class: "input text-sm sm:text-base",
              required: true,
              placeholder: "Ex: Plateforme de gestion de projets",
              maxlength: 100,
              data: {
                form_validation_target: "input",
                action: "input->form-validation#validate blur->form-validation#validate"
              } %>
          <div class="flex justify-between mt-1">
            <span data-form-validation-target="hint" class="text-xs sm:text-sm text-destructive hidden"></span>
            <span data-form-validation-target="counter" class="text-xs text-muted-foreground ml-auto"></span>
          </div>
        </div>

        <div data-controller="form-validation" data-form-validation-max-length-value="2000">
          <%= f.label :description, "Description", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
          <%= f.text_area :description,
              class: "input text-sm sm:text-base",
              rows: 5,
              placeholder: "Décrivez votre projet, ses objectifs, etc.",
              maxlength: 2000,
              data: {
                form_validation_target: "input",
                action: "input->form-validation#validate"
              } %>
          <div class="flex justify-between mt-1">
            <span data-form-validation-target="hint" class="text-xs sm:text-sm text-destructive hidden"></span>
            <span data-form-validation-target="counter" class="text-xs text-muted-foreground ml-auto"></span>
          </div>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
          <div>
            <%= f.label :status, "Statut", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.select :status,
                options_for_select(Project::STATUSES.map { |s| [s.titleize, s] }, @project.status),
                {},
                class: "input text-sm" %>
          </div>

          <div>
            <%= f.label :visibility, "Visibilité", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.select :visibility,
                options_for_select(Project::VISIBILITIES.map { |v| [v.titleize, v] }, @project.visibility),
                {},
                class: "input text-sm" %>
          </div>

          <div>
            <%= f.label :max_members, "Membres max", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.number_field :max_members, class: "input text-sm", min: 1, max: 50, value: @project.max_members || 4 %>
          </div>
        </div>

        <div>
          <%= f.label :skill_ids, "Compétences requises", class: "block text-xs sm:text-sm font-medium text-foreground mb-2 sm:mb-3" %>
          <%= render 'skill_selector', available_skills: @available_skills, selected_skill_ids: @project.skill_ids %>
        </div>

        <div class="grid grid-cols-1 sm:grid-cols-3 gap-3 sm:gap-4">
          <div>
            <%= f.label :start_date, "Date de début", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.date_field :start_date, class: "input text-sm" %>
          </div>

          <div>
            <%= f.label :end_date, "Date de fin", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.date_field :end_date, class: "input text-sm" %>
          </div>

          <div>
            <%= f.label :deadline, "Deadline", class: "block text-xs sm:text-sm font-medium text-foreground mb-1.5 sm:mb-2" %>
            <%= f.date_field :deadline, class: "input text-sm" %>
          </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-2 sm:gap-3 pt-2 sm:pt-4">
          <%= f.submit "Créer le projet", class: "btn-primary w-full sm:w-auto" %>
          <%= link_to "Annuler", projects_path, class: "btn-secondary w-full sm:w-auto text-center" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
