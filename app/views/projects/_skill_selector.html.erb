<div data-controller="skill-selector" class="space-y-4">
  <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3">
    <div class="relative flex-1 max-w-xs">
      <svg class="absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-muted-foreground" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
      </svg>
      <input type="text"
             placeholder="Filtrer les compétences..."
             class="input pl-9 py-2 text-sm"
             data-skill-selector-target="searchInput"
             data-action="input->skill-selector#filter">
    </div>
    <div class="flex items-center gap-3">
      <span data-skill-selector-target="counter" class="text-sm text-muted-foreground"></span>
      <button type="button"
              data-action="click->skill-selector#deselectAll"
              class="text-xs text-muted-foreground hover:text-foreground transition-colors">
        Tout désélectionner
      </button>
    </div>
  </div>

  <div class="border border-border rounded-lg max-h-64 overflow-y-auto p-4 bg-secondary/30">
    <% skills_by_category = available_skills.group_by(&:category) %>
    <% skills_by_category.each_with_index do |(category, skills), index| %>
      <div class="<%= 'mt-4 pt-4 border-t border-border' unless index == 0 %>">
        <h4 class="text-sm font-semibold text-foreground mb-3 flex items-center gap-2">
          <svg class="w-4 h-4 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z"></path>
          </svg>
          <%= category %>
        </h4>
        <div class="flex flex-wrap gap-2">
          <% skills.each do |skill| %>
            <label data-skill-selector-target="skillItem"
                   data-skill-name="<%= skill.name %>"
                   class="inline-flex items-center gap-2 px-3 py-1.5 rounded-lg cursor-pointer transition-all
                          bg-secondary hover:bg-secondary/80
                          has-[:checked]:bg-primary has-[:checked]:text-primary-foreground">
              <input type="checkbox"
                     name="project[skill_ids][]"
                     value="<%= skill.id %>"
                     <%= 'checked' if selected_skill_ids.include?(skill.id) %>
                     data-skill-selector-target="checkbox"
                     data-category="<%= category %>"
                     data-action="change->skill-selector#toggle"
                     class="sr-only">
              <span class="text-sm"><%= skill.name %></span>
              <svg class="w-3.5 h-3.5 hidden [:checked+span+&]:block" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
              </svg>
            </label>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>
</div>
