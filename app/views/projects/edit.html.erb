<% content_for :page_title, "Modifier #{@project.title}" %>

<div class="max-w-4xl mx-auto animate-fade-in-up">
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-foreground">Modifier le projet<span class="text-primary">.</span></h1>
    <p class="text-muted-foreground mt-2"><%= @project.title %></p>
  </div>

  <div class="card">
    <%= form_with(model: @project, local: true) do |f| %>
      <% if @project.errors.any? %>
        <div class="mb-6 p-4 bg-destructive/10 border border-destructive rounded-lg">
          <h2 class="font-bold text-destructive mb-2">
            <%= pluralize(@project.errors.count, "erreur") %> empêche la modification du projet :
          </h2>
          <ul class="list-disc list-inside text-sm text-destructive">
            <% @project.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <div class="space-y-6">
        <div data-controller="form-validation" data-form-validation-min-length-value="3" data-form-validation-max-length-value="100" data-form-validation-required-value="true">
          <%= f.label :title, "Titre du projet *", class: "block text-sm font-medium text-foreground mb-2" %>
          <%= f.text_field :title,
              class: "input",
              required: true,
              maxlength: 100,
              data: {
                form_validation_target: "input",
                action: "input->form-validation#validate blur->form-validation#validate"
              } %>
          <div class="flex justify-between mt-1">
            <span data-form-validation-target="hint" class="text-sm text-destructive hidden"></span>
            <span data-form-validation-target="counter" class="text-xs text-muted-foreground ml-auto"></span>
          </div>
        </div>

        <div data-controller="form-validation" data-form-validation-max-length-value="2000">
          <%= f.label :description, "Description", class: "block text-sm font-medium text-foreground mb-2" %>
          <%= f.text_area :description,
              class: "input",
              rows: 6,
              maxlength: 2000,
              data: {
                form_validation_target: "input",
                action: "input->form-validation#validate"
              } %>
          <div class="flex justify-between mt-1">
            <span data-form-validation-target="hint" class="text-sm text-destructive hidden"></span>
            <span data-form-validation-target="counter" class="text-xs text-muted-foreground ml-auto"></span>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <%= f.label :status, "Statut", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.select :status,
                options_for_select(Project::STATUSES.map { |s| [s.titleize, s] }, @project.status),
                {},
                class: "input" %>
          </div>

          <div>
            <%= f.label :visibility, "Visibilité", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.select :visibility,
                options_for_select(Project::VISIBILITIES.map { |v| [v.titleize, v] }, @project.visibility),
                {},
                class: "input" %>
          </div>

          <div>
            <%= f.label :max_members, "Nombre max de membres", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.number_field :max_members, class: "input", min: 1, max: 50 %>
          </div>
        </div>

        <div>
          <%= f.label :skill_ids, "Compétences requises", class: "block text-sm font-medium text-foreground mb-3" %>
          <%= render 'skill_selector', available_skills: @available_skills, selected_skill_ids: @project.skill_ids %>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <%= f.label :start_date, "Date de début", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.date_field :start_date, class: "input" %>
          </div>

          <div>
            <%= f.label :end_date, "Date de fin", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.date_field :end_date, class: "input" %>
          </div>

          <div>
            <%= f.label :deadline, "Deadline", class: "block text-sm font-medium text-foreground mb-2" %>
            <%= f.date_field :deadline, class: "input" %>
          </div>
        </div>

        <div class="flex gap-3 pt-4">
          <%= f.submit "Mettre à jour", class: "btn-primary" %>
          <%= link_to "Annuler", project_path(@project), class: "btn-secondary" %>
        </div>
      </div>
    <% end %>
  </div>
</div>
