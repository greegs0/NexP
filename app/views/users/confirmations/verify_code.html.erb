<div class="w-full max-w-md mx-auto">
  <div class="text-center mb-8">
    <div class="text-6xl mb-4">ðŸ“§</div>
    <h1 class="text-3xl font-bold tracking-tight">Confirme ton email</h1>
    <p class="mt-3 text-muted-foreground">
      On a envoyÃ© un code Ã  6 chiffres Ã 
    </p>
    <p class="mt-1 text-lg font-semibold text-primary">
      <%= params[:email] %>
    </p>
  </div>

  <% if flash[:alert] %>
    <div class="flash-alert mb-6">
      <%= flash[:alert] %>
    </div>
  <% end %>

  <% if flash[:notice] %>
    <div class="flash-notice mb-6">
      <%= flash[:notice] %>
    </div>
  <% end %>

  <div class="card">
    <%= form_with url: confirm_code_users_confirmation_path, method: :post, html: { id: "code-form", class: "space-y-6" } do |f| %>
      <%= hidden_field_tag :email, params[:email] %>

      <div>
        <label class="form-label text-center block mb-4">Entre le code reÃ§u par email</label>

        <!-- Version simple (fallback si JS ne marche pas) -->
        <div class="mb-6" id="code-simple">
          <input
            type="text"
            name="code"
            maxlength="6"
            inputmode="numeric"
            pattern="[0-9]{6}"
            autocomplete="one-time-code"
            placeholder="000000"
            class="w-full text-center text-3xl font-mono tracking-[0.5em] border-2 border-border rounded-lg py-4 focus:border-primary focus:ring-2 focus:ring-primary/20 transition"
            id="code-input-simple"
            required
          />
        </div>

        <p class="text-xs text-center text-muted-foreground">
          Le code expire dans 15 minutes
        </p>
      </div>

      <div>
        <%= submit_tag "Confirmer mon compte", class: "w-full btn-primary", id: "submit-btn" %>
      </div>
    <% end %>

    <div class="mt-6 text-center">
      <%= form_with url: resend_code_users_confirmation_path, method: :post, html: { class: "inline" } do |f| %>
        <%= hidden_field_tag :email, params[:email] %>
        <button type="submit" class="text-sm text-primary hover:text-primary/80 transition">
          ðŸ“¨ Renvoyer le code
        </button>
      <% end %>
    </div>
  </div>

  <div class="mt-6 text-center">
    <%= link_to "â† Retour Ã  la connexion", new_session_path(:user), class: "text-sm text-muted-foreground hover:text-foreground transition" %>
  </div>
</div>

<%= javascript_tag nonce: true do %>
window.addEventListener('load', function() {
  const input = document.getElementById('code-input-simple');
  if (input) {
    // Focus automatique
    setTimeout(() => input.focus(), 200);

    // Filtrer les non-chiffres
    input.addEventListener('input', function() {
      this.value = this.value.replace(/\D/g, '').slice(0, 6);
    });
  }
});
<% end %>
