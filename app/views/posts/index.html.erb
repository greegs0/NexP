<% content_for :page_title, "Posts" %>

<div class="max-w-4xl mx-auto">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center justify-between gap-4 mb-8 animate-fade-in-up">
    <div>
      <div class="inline-flex items-center gap-2 text-sm font-mono text-muted-foreground mb-2">
        Fil d'actualité
      </div>
      <h1 class="text-3xl md:text-4xl font-bold text-foreground tracking-tight">
        Découvre les posts<span class="text-primary">.</span>
      </h1>
      <p class="text-muted-foreground mt-2">Partage tes idées et découvre la communauté</p>
    </div>
    <%= link_to new_post_path, class: "btn-primary inline-flex items-center gap-2 self-start" do %>
      <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
      </svg>
      Créer un post
    <% end %>
  </div>

  <!-- Posts Feed -->
  <% if @posts.any? %>
    <div class="space-y-6 mb-8">
      <% @posts.each_with_index do |post, index| %>
        <div class="card animate-fade-in-up" style="animation-delay: <%= 100 + (index * 50) %>ms;">
          <!-- Header du post -->
          <div class="flex items-start justify-between mb-4">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-primary text-primary-foreground rounded-full flex items-center justify-center font-bold">
                <%= post.user.display_name[0].upcase %>
              </div>
              <div>
                <%= link_to post.user.display_name, user_path(post.user), class: "font-bold text-foreground hover:text-primary" %>
                <div class="text-sm text-muted-foreground">
                  <%= time_ago_in_words(post.created_at) %> ago
                </div>
              </div>
            </div>
            <% if post.user == current_user %>
              <div class="flex gap-2">
                <%= link_to edit_post_path(post), class: "text-muted-foreground hover:text-primary" do %>
                  <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                  </svg>
                <% end %>
              </div>
            <% end %>
          </div>

          <!-- Contenu -->
          <div class="mb-4">
            <p class="text-foreground whitespace-pre-wrap"><%= post.content %></p>
            <% if post.image.attached? %>
              <div class="mt-3">
                <%= link_to post_path(post) do %>
                  <%= image_tag post.image.variant(resize_to_limit: [600, 400]), class: "rounded-lg border border-border w-full hover:opacity-90 transition-opacity" %>
                <% end %>
              </div>
            <% end %>
          </div>

          <!-- Actions -->
          <div class="flex items-center gap-6 text-muted-foreground border-t border-border pt-4">
            <%= render 'like_button', post: post, size: 5, show_count_label: false %>

            <%= link_to post_path(post), class: "inline-flex items-center gap-2 hover:text-primary transition-colors group" do %>
              <svg class="w-5 h-5 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
              </svg>
              <span class="text-sm font-medium"><%= post.comments_count %></span>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- Pagination -->
    <div class="flex justify-center animate-fade-in">
      <%= paginate @posts %>
    </div>
  <% else %>
    <div class="card text-center py-16 animate-fade-in-up">
      <svg class="w-16 h-16 text-muted-foreground mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
      </svg>
      <p class="text-muted-foreground mb-6">Aucun post pour le moment.</p>
      <%= link_to new_post_path, class: "btn-primary inline-flex items-center gap-2" do %>
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"></path>
        </svg>
        Créer le premier post
      <% end %>
    </div>
  <% end %>
</div>
